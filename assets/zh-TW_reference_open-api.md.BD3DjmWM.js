import{_ as a,C as o,o as l,c as n,ae as d,E as s,w as i,a as c}from"./chunks/framework.f9sx20OT.js";const _=JSON.parse('{"title":"開放接口 (OpenAPI) 指南","description":"","frontmatter":{},"headers":[],"relativePath":"zh-TW/reference/open-api.md","filePath":"zh-TW/reference/open-api.md","lastUpdated":1769480114000}'),r={name:"zh-TW/reference/open-api.md"};function p(g,e,h,u,f,x){const t=o("callout");return l(),n("div",null,[e[1]||(e[1]=d(`<h1 id="開放接口-openapi-指南" tabindex="-1">開放接口 (OpenAPI) 指南 <a class="header-anchor" href="#開放接口-openapi-指南" aria-label="Permalink to &quot;開放接口 (OpenAPI) 指南&quot;">​</a></h1><p>PieMDM 提供了強大的 OpenAPI，允許外部系統通過安全認證的方式訪問主數據。OpenAPI 採用了基於規範請求（Canonical Request）的 HMAC-SHA256 簽名機制，確保請求的真實性和完整性。</p><h2 id="_1-認證機制" tabindex="-1">1. 認證機制 <a class="header-anchor" href="#_1-認證機制" aria-label="Permalink to &quot;1. 認證機制&quot;">​</a></h2><p>所有 OpenAPI 請求必須在 Header 中攜帶以下認證參數：</p><table tabindex="0"><thead><tr><th style="text-align:left;">Header 參數</th><th style="text-align:left;">說明</th><th style="text-align:left;">示例</th></tr></thead><tbody><tr><td style="text-align:left;"><code>X-App-Id</code></td><td style="text-align:left;">應用標識，在“應用管理”中獲取</td><td style="text-align:left;"><code>app_592837482...</code></td></tr><tr><td style="text-align:left;"><code>X-Timestamp</code></td><td style="text-align:left;">請求發送時的 Unix 時間戳（秒）</td><td style="text-align:left;"><code>1674829374</code></td></tr><tr><td style="text-align:left;"><code>X-Nonce</code></td><td style="text-align:left;">長度至少 16 位的隨機字符串，用於防重放攻擊</td><td style="text-align:left;"><code>abcdef1234567890</code></td></tr><tr><td style="text-align:left;"><code>X-Sign</code></td><td style="text-align:left;">根據簽名算法計算出的摘要值（Hex 編碼）</td><td style="text-align:left;"><code>a1b2c3d4...</code></td></tr></tbody></table><h3 id="_1-1-簽名算法" tabindex="-1">1.1 簽名算法 <a class="header-anchor" href="#_1-1-簽名算法" aria-label="Permalink to &quot;1.1 簽名算法&quot;">​</a></h3><p>簽名的計算過程如下：</p><ol><li><p><strong>構造規範請求字符串 (Canonical Request)</strong>： 格式為各部分由換行符 <code>\\n</code> 連接：</p><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>HTTPMethod + &quot;\\n&quot; +</span></span>
<span class="line"><span>CanonicalURI + &quot;\\n&quot; +</span></span>
<span class="line"><span>CanonicalQueryString + &quot;\\n&quot; +</span></span>
<span class="line"><span>SHA256(RequestBody) + &quot;\\n&quot; +</span></span>
<span class="line"><span>X-Timestamp + &quot;\\n&quot; +</span></span>
<span class="line"><span>X-Nonce</span></span></code></pre></div><ul><li><strong>HTTPMethod</strong>: 大寫的 HTTP 方法，如 <code>GET</code> 或 <code>POST</code>。</li><li><strong>CanonicalURI</strong>: 請求的完整路徑，必須以 <code>/</code> 開頭，如 <code>/openapi/v1/entities/users</code>。</li><li><strong>CanonicalQueryString</strong>: 排序後的查詢參數字符串。按參數名 ASCII 升序排列，格式為 <code>key1=value1&amp;key2=value2</code>。</li><li><strong>SHA256(RequestBody)</strong>: 請求體的 SHA256 哈希值（小寫 Hex）。若 Body 為空，則哈希值為：<code>e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855</code>。</li><li><strong>X-Timestamp</strong> 和 <strong>X-Nonce</strong>: 與 Header 中的值保持嚴格一致。</li></ul></li><li><p><strong>計算簽名</strong>： 使用應用的 <code>AppSecret</code> 作為 Key，對上述規範字符串進行 HMAC-SHA256 計算：</p><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Signature = Hex(HMAC-SHA256(AppSecret, CanonicalRequest))</span></span></code></pre></div></li></ol><h2 id="_2-安全策略" tabindex="-1">2. 安全策略 <a class="header-anchor" href="#_2-安全策略" aria-label="Permalink to &quot;2. 安全策略&quot;">​</a></h2><p>除了簽名驗證，OpenAPI 還提供了多重安全保障：</p><ul><li><strong>IP 白名單</strong>：只有在“應用管理”中配置的白名單 IP 才能成功調用接口。</li><li><strong>權限審計</strong>：所有 OpenAPI 的調用都會被詳細記錄，包括請求參數、響應結果、調用耗時等。</li><li><strong>Nonce 防重放</strong>：每個 Nonce 僅能使用一次。系統會緩存最近使用的 Nonce，重複提交將返回 <code>401 Unauthorized</code>。</li><li><strong>時間窗口校驗</strong>：<code>X-Timestamp</code> 與服務器當前時間的偏差超過 5 分鐘將被拒絕。</li></ul><h2 id="_3-核心接口" tabindex="-1">3. 核心接口 <a class="header-anchor" href="#_3-核心接口" aria-label="Permalink to &quot;3. 核心接口&quot;">​</a></h2><p>所有接口的基礎路徑為：<code>/openapi/v1</code></p><h3 id="_3-1-獲取實體列表" tabindex="-1">3.1 獲取實體列表 <a class="header-anchor" href="#_3-1-獲取實體列表" aria-label="Permalink to &quot;3.1 獲取實體列表&quot;">​</a></h3><p><strong>GET</strong> <code>/openapi/v1/entities/{table_code}</code></p><p><strong>查詢參數</strong>：</p><ul><li><code>page</code>: 頁碼，默認 1</li><li><code>pageSize</code>: 每頁數量，默認 15，最大 100</li><li><code>id</code>: 可選，精確過濾 ID</li><li><code>status</code>: 可選，狀態過濾</li><li><code>created_at</code>: 可選，創建時間過濾</li></ul><h3 id="_3-2-獲取實體詳情" tabindex="-1">3.2 獲取實體詳情 <a class="header-anchor" href="#_3-2-獲取實體詳情" aria-label="Permalink to &quot;3.2 獲取實體詳情&quot;">​</a></h3><p><strong>GET</strong> <code>/openapi/v1/entities/{table_code}/{id}</code></p><h2 id="_4-錯誤碼參考" tabindex="-1">4. 錯誤碼參考 <a class="header-anchor" href="#_4-錯誤碼參考" aria-label="Permalink to &quot;4. 錯誤碼參考&quot;">​</a></h2><table tabindex="0"><thead><tr><th style="text-align:left;">錯誤消息</th><th style="text-align:left;">說明</th></tr></thead><tbody><tr><td style="text-align:left;"><code>AUTH_FAILED</code></td><td style="text-align:left;"><code>X-App-Id</code> 無效或缺失</td></tr><tr><td style="text-align:left;"><code>SIGNATURE_INVALID</code></td><td style="text-align:left;">簽名驗證失敗</td></tr><tr><td style="text-align:left;"><code>TOKEN_EXPIRED</code></td><td style="text-align:left;">時間戳超時或 Nonce 已被使用</td></tr><tr><td style="text-align:left;"><code>IP_NOT_ALLOWED</code></td><td style="text-align:left;">客戶端 IP 不在白名單中</td></tr><tr><td style="text-align:left;"><code>PERMISSION_DENIED</code></td><td style="text-align:left;">應用無權訪問指定的實體表</td></tr></tbody></table>`,21)),s(t,{emoji:"💡","background-color":"light-blue","border-color":"blue"},{default:i(()=>[...e[0]||(e[0]=[c(" 提示：更多接口（如創建、修改實體）正在開發中。如有緊急需求，請聯繫技術支持。 ",-1)])]),_:1})])}const y=a(r,[["render",p]]);export{_ as __pageData,y as default};

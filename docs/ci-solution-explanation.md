# CI é…ç½®æ–¹æ¡ˆè¯´æ˜

## é—®é¢˜åœºæ™¯

### å½“å‰é…ç½®çš„é—®é¢˜

**ci.yml é…ç½®ï¼š**
```yaml
on:
  pull_request:
    paths-ignore:
      - 'docs/site/**'  # å¿½ç•¥æ–‡æ¡£è·¯å¾„
```

**docs.yml é…ç½®ï¼š**
```yaml
on:
  pull_request:
    paths:
      - 'docs/site/**'  # åªç›‘å¬æ–‡æ¡£è·¯å¾„
```

### é—®é¢˜è¡¨ç°

1. **åªä¿®æ”¹æ–‡æ¡£æ—¶ï¼š**
   - âŒ `ci.yml` ä¸è¿è¡Œ â†’ `test-backend` å’Œ `test-frontend` çŠ¶æ€æ£€æŸ¥ä¸å­˜åœ¨
   - âœ… `docs.yml` è¿è¡Œ â†’ `build-docs` çŠ¶æ€æ£€æŸ¥å­˜åœ¨
   - ğŸ”´ **ç»“æœï¼š** å¦‚æœåˆ†æ”¯ä¿æŠ¤è§„åˆ™è¦æ±‚ `test-backend` å’Œ `test-frontend`ï¼ŒPR æ— æ³•åˆå¹¶ï¼ˆç¼ºå°‘å¿…éœ€æ£€æŸ¥ï¼‰

2. **åªä¿®æ”¹ä»£ç æ—¶ï¼š**
   - âœ… `ci.yml` è¿è¡Œ â†’ `test-backend` å’Œ `test-frontend` çŠ¶æ€æ£€æŸ¥å­˜åœ¨
   - âŒ `docs.yml` ä¸è¿è¡Œ â†’ `build-docs` çŠ¶æ€æ£€æŸ¥ä¸å­˜åœ¨
   - ğŸ”´ **ç»“æœï¼š** å¦‚æœåˆ†æ”¯ä¿æŠ¤è§„åˆ™è¦æ±‚ `build-docs`ï¼ŒPR æ— æ³•åˆå¹¶ï¼ˆç¼ºå°‘å¿…éœ€æ£€æŸ¥ï¼‰

## è§£å†³æ–¹æ¡ˆï¼šæ¡ä»¶æ‰§è¡Œ

### æ ¸å¿ƒæ€è·¯

**ç§»é™¤è·¯å¾„è¿‡æ»¤ï¼Œè®© workflow å§‹ç»ˆè¿è¡Œï¼Œä½†åœ¨æ­¥éª¤çº§åˆ«æ ¹æ®è·¯å¾„æ¡ä»¶å†³å®šæ˜¯å¦æ‰§è¡Œå®é™…æµ‹è¯•ã€‚**

### æ–¹æ¡ˆæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PR æäº¤ï¼ˆä»»ä½•æ–‡ä»¶å˜æ›´ï¼‰                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                        â”‚
   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
   â”‚ ci.yml  â”‚              â”‚docs.yml â”‚
   â”‚ å§‹ç»ˆè¿è¡Œâ”‚              â”‚ å§‹ç»ˆè¿è¡Œâ”‚
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
        â”‚                        â”‚
   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
   â”‚  æ£€æµ‹æ–‡ä»¶å˜æ›´è·¯å¾„                  â”‚
   â”‚  (ä½¿ç”¨ paths-filter action)      â”‚
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  æ ¹æ®è·¯å¾„æ¡ä»¶æ‰§è¡Œæ­¥éª¤              â”‚
   â”‚                                  â”‚
   â”‚  â€¢ åªæ”¹æ–‡æ¡£ â†’ è·³è¿‡æµ‹è¯•ï¼Œç›´æ¥æˆåŠŸ  â”‚
   â”‚  â€¢ åªæ”¹ä»£ç  â†’ è¿è¡Œæµ‹è¯•           â”‚
   â”‚  â€¢ éƒ½æ”¹äº† â†’ è¿è¡Œæµ‹è¯•             â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å®ç°æ–¹å¼

#### 1. ç§»é™¤è·¯å¾„è¿‡æ»¤

```yaml
# ä¿®æ”¹å‰
on:
  pull_request:
    paths-ignore:
      - 'docs/site/**'

# ä¿®æ”¹å
on:
  pull_request:
    # ç§»é™¤ paths-ignoreï¼Œè®© workflow å§‹ç»ˆè¿è¡Œ
```

#### 2. æ·»åŠ è·¯å¾„æ£€æµ‹æ­¥éª¤

ä½¿ç”¨ `dorny/paths-filter` action æ£€æµ‹æ–‡ä»¶å˜æ›´ï¼š

```yaml
- name: Check if backend files changed
  id: backend-changed
  uses: dorny/paths-filter@v2
  with:
    filters: |
      backend:
        - 'backend/**'
        - '!docs/site/**'  # æ’é™¤æ–‡æ¡£è·¯å¾„
```

#### 3. æ¡ä»¶æ‰§è¡Œæµ‹è¯•æ­¥éª¤

```yaml
- name: Run backend tests
  if: steps.backend-changed.outputs.backend == 'true'
  run: |
    cd backend
    go test -v ./...
```

### æ‰§è¡Œæµç¨‹ç¤ºä¾‹

#### åœºæ™¯ 1ï¼šåªä¿®æ”¹æ–‡æ¡£

```
1. PR æäº¤ï¼ˆåªä¿®æ”¹ docs/site/**ï¼‰
   â†“
2. ci.yml è¢«è§¦å‘è¿è¡Œ
   â†“
3. æ£€æµ‹è·¯å¾„ï¼šbackend-changed = false
   â†“
4. è·³è¿‡æµ‹è¯•æ­¥éª¤ï¼ˆif æ¡ä»¶ä¸æ»¡è¶³ï¼‰
   â†“
5. Job æˆåŠŸå®Œæˆ âœ…
   â†“
6. test-backend çŠ¶æ€æ£€æŸ¥å­˜åœ¨ä¸”é€šè¿‡ âœ…
```

#### åœºæ™¯ 2ï¼šåªä¿®æ”¹ä»£ç 

```
1. PR æäº¤ï¼ˆåªä¿®æ”¹ backend/**ï¼‰
   â†“
2. ci.yml è¢«è§¦å‘è¿è¡Œ
   â†“
3. æ£€æµ‹è·¯å¾„ï¼šbackend-changed = true
   â†“
4. æ‰§è¡Œæµ‹è¯•æ­¥éª¤
   â†“
5. Job æˆåŠŸå®Œæˆ âœ…
   â†“
6. test-backend çŠ¶æ€æ£€æŸ¥å­˜åœ¨ä¸”é€šè¿‡ âœ…
```

#### åœºæ™¯ 3ï¼šåŒæ—¶ä¿®æ”¹ä»£ç å’Œæ–‡æ¡£

```
1. PR æäº¤ï¼ˆä¿®æ”¹ backend/** å’Œ docs/site/**ï¼‰
   â†“
2. ci.yml å’Œ docs.yml éƒ½è¢«è§¦å‘
   â†“
3. æ£€æµ‹è·¯å¾„ï¼šbackend-changed = true
   â†“
4. æ‰§è¡Œæµ‹è¯•æ­¥éª¤
   â†“
5. æ‰€æœ‰æ£€æŸ¥éƒ½è¿è¡Œå¹¶é€šè¿‡ âœ…
```

## ä¼˜åŠ¿

1. âœ… **çŠ¶æ€æ£€æŸ¥å§‹ç»ˆå­˜åœ¨**ï¼šæ— è®ºä¿®æ”¹ä»€ä¹ˆæ–‡ä»¶ï¼Œæ‰€æœ‰å¿…éœ€çš„çŠ¶æ€æ£€æŸ¥éƒ½ä¼šå‡ºç°
2. âœ… **æ™ºèƒ½è·³è¿‡**ï¼šåªä¿®æ”¹æ–‡æ¡£æ—¶ï¼Œè‡ªåŠ¨è·³è¿‡ä¸å¿…è¦çš„æµ‹è¯•ï¼ŒèŠ‚çœ CI èµ„æº
3. âœ… **åˆ†æ”¯ä¿æŠ¤å…¼å®¹**ï¼šæ»¡è¶³ GitHub åˆ†æ”¯ä¿æŠ¤è§„åˆ™çš„è¦æ±‚
4. âœ… **çµæ´»é…ç½®**ï¼šå¯ä»¥æ ¹æ®éœ€è¦è°ƒæ•´è·¯å¾„è¿‡æ»¤è§„åˆ™

## æ³¨æ„äº‹é¡¹

1. **Job è¿è¡Œæ—¶é—´**ï¼šå³ä½¿è·³è¿‡æµ‹è¯•ï¼Œjob ä»ä¼šè¿è¡Œï¼ˆä½†ä¼šå¾ˆå¿«å®Œæˆï¼‰
2. **èµ„æºæ¶ˆè€—**ï¼šç›¸æ¯”å®Œå…¨è·³è¿‡ workflowï¼Œä¼šæ¶ˆè€—å°‘é‡ CI èµ„æº
3. **é…ç½®å¤æ‚åº¦**ï¼šéœ€è¦åœ¨æ¯ä¸ªç›¸å…³æ­¥éª¤æ·»åŠ æ¡ä»¶åˆ¤æ–­

## æ›¿ä»£æ–¹æ¡ˆ

å¦‚æœä¸æƒ³è®© job è¿è¡Œï¼Œå¯ä»¥è€ƒè™‘ï¼š
- ä½¿ç”¨ GitHub çš„ "Do not require status checks on creation" é€‰é¡¹
- æˆ–è€…æ¥å—æŸäº›åœºæ™¯ä¸‹çŠ¶æ€æ£€æŸ¥ç¼ºå¤±çš„æƒ…å†µ

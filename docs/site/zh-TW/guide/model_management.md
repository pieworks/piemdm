# 模型管理 (數據建模)

模型管理是 PieMDM 的核心功能，它定義了主數據的邏輯結構。通過可視化界面，您可以輕鬆創建實體表並定義其屬性字段，支持高度靈活的擴展。

## 1. 概念說明

在 PieMDM 中，一個“模型”通常對應底層數據庫的一組表。當您在後台定義一個實體表時，系統會自動維護以下三類表：

- **主表 (t_{code})**：存儲生效的、標準的主數據。
- **草稿表 (t_{code}_draft)**：存儲正在審批中或尚未發布的臨時數據。
- **歷史表 (t_{code}_log)**：記錄該實體數據的所有變更軌跡。

## 2. 實體表管理

點擊“基礎設置 > 模型管理”進入列表頁：

1. **新建實體**：填寫實體名稱和唯一的“實體編碼”。
2. **編碼規範**：建議使用大駝峰或小寫下劃線命名（如 `User` 或 `material_info`）。**注意：實體編碼一旦創建，不支持修改。**
3. **關聯關係**：您可以設置表的層級關係，例如將“辦公地址”設置為“組織機構”的子表。

## 3. 字段 (屬性) 定義

在實體詳情頁中，您可以管理該實體的所有屬性字段。

### 3.1 核心屬性
- **核心類型 (Field Type)**：系統內置了多種類型：
  - **基礎**：單行文本、多行文本、數字、布爾值。
  - **選項**：單選（Select）、多選（Checkbox）、下拉關聯（Relation）。
  - **媒體**：圖片上傳、附件上傳。
  - **日期**：日期（DatePicker）、時間、日期時間。
- **必填項 (Required)**：勾選後，在實體數據維護時該字段不能為空。
- **唯一性 (Unique)**：勾選後，系統會自動在主表和草稿表創建唯一索引，防止數據重複。
- **查詢過濾 (Filter)**：勾選後，該字段將出現在實體數據頁面的搜索區域。

### 3.2 關聯字段 (Relation)
關聯字段是建模的高級特性，支持引用其他實體表的數據：
- **關聯表**：選擇目標實體表。
- **顯示字段**：選擇在下拉列表中展示給用戶看的字段（如選擇 ID 關聯但顯示“姓名”）。

## 4. 發布模型 (Schema Public)

**關鍵操作**：在修改字段（新增、刪除或調整長度）後，模型並不會立即在數據庫生效。

點擊頁面右上角的 **“發布”** 按鈕，系統會對比當前定義與數據庫物理結構，自動執行 `ALTER TABLE` 語句來同步主表、草稿表和日誌表。

<callout emoji="⚠️" background-color="light-yellow">
注意：在執行“發布”操作前，請確保當前實體的所有審批任務已處理完畢，以免引起數據結構衝突。
</callout>

## 5. 常見問題

<callout emoji="❓" background-color="light-purple">
字段編碼修改會丟失數據嗎？
</callout>

字段編碼直接對應數據庫列名。修改已發布的字段編碼會導致系統執行“刪除舊列，創建新列”的操作，從而導致**舊列數據丟失**。建議在開發環境確認無誤後再進行變更。

<callout emoji="❓" background-color="light-purple">
字段排序有什麼影響？
</callout>

字段的排序值（Sort）決定了在“實體管理”表單中字段出現的先後順序，以及在表格視圖中的列順序。

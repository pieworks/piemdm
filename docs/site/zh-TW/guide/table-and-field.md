# 表與字段管理

PieMDM 允許管理員根據業務需求自定義數據模型。通過“表與字段管理”，您可以定義主數據實體及其屬性。

## 表管理

在 PieMDM 中，“表”代表一個主數據對象（如“供應商”、“物料”、“客戶”等）。

### 1. 表屬性
創建一個新表時，需要配置以下關鍵屬性：

- **表名 (Code)**：系統的唯一標識，僅限小寫字母、數字和下劃線（如 `mdm_material`）。系統會自動為物理表名添加 `t_` 前綴。
- **名稱 (Name)**：顯示的業務名稱（如“物料主數據”）。
- **展示模式 (DisplayMode)**：
  - `List`：列表模式，適用於絕大多數扁平化數據。
  - `Tree`：樹形模式，適用於具有層級關係的數據（如“組織架構”、“分類字典”）。
- **表類型 (TableType)**：
  - `Entity`：獨立的主實體表。
  - `Item`：行項目表，必須關聯到一個父表。

### 2. 關聯配置（僅 Item 類型）
如果表類型為 `Item`，需要額外配置：
- **父表 (ParentTable)**：該行項目所屬的主表。
- **關聯字段**：定義子表與父表之間的關聯鍵。

## 字段管理

字段定義了表中存儲的具體數據項。PieMDM 提供了豐富的字段類型和驗證規則。

### 1. 字段類型預設
字段類型分為以下幾個大類：

| 分組 | 包含類型 | 說明 |
| :--- | :--- | :--- |
| **基本類型** | 文本、多行文本、數字、整數、百分比、密碼、URL、郵箱、手機號 | 基礎數據存儲 |
| **選擇類型** | 下拉單選、下拉多選、單選框組、複選框組、開關 | 預定義選項數據 |
| **日期時間** | 日期、時間、日期時間 | 時間維度數據 |
| **關係類型** | 多對一 (BelongsTo)、一對多 (HasMany)、多對多 (ManyToMany) | 實現跨表數據關聯 |
| **高級類型** | 自動編碼、附件、富文本、公式 | 複雜業務場景支持 |

### 2. 字段配置項
- **字段編碼**：數據庫中的列名。
- **顯示名稱**：表單和列表中的標籤。
- **UI 組件**：定義該字段在界面上的呈現方式（如 `Input`, `Select`, `DatePicker`）。
- **驗證規則**：
  - **必填項**：是否允許為空。
  - **長度限制**：最大/最小字符數。
  - **數值範圍**：最大/最小值。
  - **正則匹配**：自定義格式校驗。

## 系統預留字段

為了支持審計、版本管理和審批工作流，PieMDM 會為每個表自動添加以下預留字段。用戶不得創建與這些字段編碼相同的自定義字段。

- **審計字段**：`id`, `created_at`, `updated_at`, `deleted_at`, `created_by`, `updated_by`。
- **業務狀態**：`status` (數據狀態), `draft_status` (草稿狀態)。
- **流程追蹤**：`approval_code` (審批單號), `entity_id` (原始實體 ID)。

## 操作流程

1. **新建表**：定義表的基本信息和存儲引擎配置。
2. **定義字段**：根據業務屬性逐一添加字段，配置其類型和校驗規則。
3. **生成物理表**：保存配置後，系統會在數據庫中自動創建或更新對應的物理表結構。
4. **權限分配**：在“菜單管理”中為新表配置訪問入口，並為相應角色分配查看和編輯權限。

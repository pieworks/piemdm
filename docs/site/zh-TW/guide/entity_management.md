# 實體管理 (數據維護)

PieMDM 提供了靈活的數據維護功能，支持基於元數據配置自動生成動態表單。用戶可以通過頁面操作、批量導入等方式來維護業務實體數據。

## 1. 核心流程

在 PieMDM 中，數據的維護遵循以下核心流程：

1. **權限驗證**：系統首先檢查當前用戶是否具有該表的維護權限（通過“表權限管理”配置）。
2. **表單渲染**：前端根據該表定義的“字段管理”信息，自動渲染出對應的輸入控件。
3. **元數據驅動**：下拉框、附件上傳、日期選擇等控件均由字段的 `options` 配置驅動。
4. **變更原因**：無論是新增還是修改，系統都**強制要求**填寫“修改原因”，這對於審計和審批至關重要。
5. **審批流判斷**：
   - 如果該表對應的操作（如 `Create` 或 `Update`）配置了[審批流](./approval-flow.md)，數據將首先保存到 `_draft`（草稿）表中，並自動觸發審批流程。
   - 如果未配置審批流，數據將直接更新到正式業務表中。

## 2. 操作指南

### 2.1 新增實體

1. 進入對應的業務菜單。
2. 點擊頁面上方的 **“新增”** 按鈕。
3. **填寫修改原因**：在表單頂部，必須輸入本次操作的原因。
4. **填寫表單數據**：
   - **基礎字段**：文本、數字、布爾值等直接輸入。
   - **自動編碼**：如果字段定義為“自動編碼”，則無需人工干預，系統在保存時會自動生成（頁面展現為“自動生成”）。
   - **關聯下拉**：系統會根據配置的關聯表自動加載選項。如果選項較多，支持搜索過濾。
   - **日期/時間**：使用內置的日期時間選擇器，且系統通常會自動初始化當前時間作為默認值。
   - **附件上傳**：支持文件拖拽或點擊上傳，支持配置多選和文件類型限制。
5. **提交保存**：點擊“提交”按鈕，系統將根據審批配置進行後續處理。

### 2.2 編輯與更新

1. 在列表頁找到目標數據，點擊 **“編輯”**。
2. 系統會提取當前最新數據填充到表單中。
3. 修改完成後，必須填寫**新的修改原因**。
4. 提交後，若有審批流，由於數據處於“待審批”狀態，列表頁通常會顯示該數據正在流程中，禁止再次編輯直至流程結束。

## 3. 高級維護功能

### 3.1 批量導入

PieMDM 支持通過 Excel 快速導入大量數據：

1. **下載模板**：點擊“下載模板”，系統會生成一個包含所有非系統字段的 Excel 模板。
2. **填寫數據**：在 Excel 中按照約定的格式填寫數據（注意：關聯字段通常需要填寫 Code 或 ID）。
3. **上傳導入**：選擇文件並填寫“導入原因”，點擊確認。
4. 系統會逐行校驗數據合法性，並觸發對應的審批或直接保存邏輯。

### 3.2 批量更新與刪除

- **批量更新狀態**：在列表頁勾選多條數據，可以批量修改其“狀態”字段（如凍結、註銷等）。
- **批量刪除**：勾選數據後點擊“批量刪除”，同樣需要填寫刪除原因。系統支持“軟刪除”機制，數據記錄在數據庫中仍會保留，但標記為已刪除。

## 4. 常見問題 (FAQ)

<callout emoji="💡" background-color="light-blue">
為何我點擊提交後數據沒有立即出現在列表頁？
</callout>

這通常是因為該表配置了**審批流**。數據目前存在於“審批草稿”中。只有當審批流程最終通過後，系統才會將數據從草稿表同步到正式業務表。您可以前往“我的申請”中查看審批進度。

<callout emoji="⚠️" background-color="light-yellow">
為何某些下拉框加載不出內容？
</callout>

請聯繫系統管理員檢查“字段管理”中的“數據源/關聯配置”。確保關聯表已配置正確，且當前用戶有權訪問該關聯表的數據。

# 模型管理 (数据建模)

模型管理是 PieMDM 的核心功能，它定义了主数据的逻辑结构。通过可视化界面，您可以轻松创建实体表并定义其属性字段，支持高度灵活的扩展。

## 1. 概念说明

在 PieMDM 中，一个“模型”通常对应底层数据库的一组表。当您在后台定义一个实体表时，系统会自动维护以下三类表：

- **主表 (t_{code})**：存储生效的、标准的主数据。
- **草稿表 (t_{code}_draft)**：存储正在审批中或尚未发布的临时数据。
- **历史表 (t_{code}_log)**：记录该实体数据的所有变更轨迹。

## 2. 实体表管理

点击“基础设置 > 模型管理”进入列表页：

1. **新建实体**：填写实体名称和唯一的“实体编码”。
2. **编码规范**：建议使用大驼峰或小写下划线命名（如 `User` 或 `material_info`）。**注意：实体编码一旦创建，不支持修改。**
3. **关联关系**：您可以设置表的层级关系，例如将“办公地址”设置为“组织机构”的子表。

## 3. 字段 (属性) 定义

在实体详情页中，您可以管理该实体的所有属性字段。

### 3.1 核心属性
- **核心类型 (Field Type)**：系统内置了多种类型：
  - **基础**：单行文本、多行文本、数字、布尔值。
  - **选项**：单选（Select）、多选（Checkbox）、下拉关联（Relation）。
  - **媒体**：图片上传、附件上传。
  - **日期**：日期（DatePicker）、时间、日期时间。
- **必填项 (Required)**：勾选后，在实体数据维护时该字段不能为空。
- **唯一性 (Unique)**：勾选后，系统会自动在主表和草稿表创建唯一索引，防止数据重复。
- **查询过滤 (Filter)**：勾选后，该字段将出现在实体数据页面的搜索区域。

### 3.2 关联字段 (Relation)
关联字段是建模的高级特性，支持引用其他实体表的数据：
- **关联表**：选择目标实体表。
- **显示字段**：选择在下拉列表中展示给用户看的字段（如选择 ID 关联但显示“姓名”）。

## 4. 发布模型 (Schema Public)

**关键操作**：在修改字段（新增、删除或调整长度）后，模型并不会立即在数据库生效。

点击页面右上角的 **“发布”** 按钮，系统会对比当前定义与数据库物理结构，自动执行 `ALTER TABLE` 语句来同步主表、草稿表和日志表。

<callout emoji="⚠️" background-color="light-yellow">
注意：在执行“发布”操作前，请确保当前实体的所有审批任务已处理完毕，以免引起数据结构冲突。
</callout>

## 5. 常见问题

<callout emoji="❓" background-color="light-purple">
字段编码修改会丢失数据吗？
</callout>

字段编码直接对应数据库列名。修改已发布的字段编码会导致系统执行“删除旧列，创建新列”的操作，从而导致**旧列数据丢失**。建议在开发环境确认无误后再进行变更。

<callout emoji="❓" background-color="light-purple">
字段排序有什么影响？
</callout>

字段的排序值（Sort）决定了在“实体管理”表单中字段出现的先后顺序，以及在表格视图中的列顺序。

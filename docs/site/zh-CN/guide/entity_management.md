# 实体管理 (数据维护)

PieMDM 提供了灵活的数据维护功能，支持基于元数据配置自动生成动态表单。用户可以通过页面操作、批量导入等方式来维护业务实体数据。

## 1. 核心流程

在 PieMDM 中，数据的维护遵循以下核心流程：

1. **权限验证**：系统首先检查当前用户是否具有该表的维护权限（通过“表权限管理”配置）。
2. **表单渲染**：前端根据该表定义的“字段管理”信息，自动渲染出对应的输入控件。
3. **元数据驱动**：下拉框、附件上传、日期选择等控件均由字段的 `options` 配置驱动。
4. **变更原因**：无论是新增还是修改，系统都**强制要求**填写“修改原因”，这对于审计和审批至关重要。
5. **审批流判断**：
   - 如果该表对应的操作（如 `Create` 或 `Update`）配置了[审批流](./approval-flow.md)，数据将首先保存到 `_draft`（草稿）表中，并自动触发审批流程。
   - 如果未配置审批流，数据将直接更新到正式业务表中。

## 2. 操作指南

### 2.1 新增实体

1. 进入对应的业务菜单。
2. 点击页面上方的 **“新增”** 按钮。
3. **填写修改原因**：在表单顶部，必须输入本次操作的原因。
4. **填写表单数据**：
   - **基础字段**：文本、数字、布尔值等直接输入。
   - **自动编码**：如果字段定义为“自动编码”，则无需人工干预，系统在保存时会自动生成（页面展现为“自动生成”）。
   - **关联下拉**：系统会根据配置的关联表自动加载选项。如果选项较多，支持搜索过滤。
   - **日期/时间**：使用内置的日期时间选择器，且系统通常会自动初始化当前时间作为默认值。
   - **附件上传**：支持文件拖拽或点击上传，支持配置多选和文件类型限制。
5. **提交保存**：点击“提交”按钮，系统将根据审批配置进行后续处理。

### 2.2 编辑与更新

1. 在列表页找到目标数据，点击 **“编辑”**。
2. 系统会提取当前最新数据填充到表单中。
3. 修改完成后，必须填写**新的修改原因**。
4. 提交后，若有审批流，由于数据处于“待审批”状态，列表页通常会显示该数据正在流程中，禁止再次编辑直至流程结束。

## 3. 高级维护功能

### 3.1 批量导入

PieMDM 支持通过 Excel 快速导入大量数据：

1. **下载模板**：点击“下载模板”，系统会生成一个包含所有非系统字段的 Excel 模板。
2. **填写数据**：在 Excel 中按照约定的格式填写数据（注意：关联字段通常需要填写 Code 或 ID）。
3. **上传导入**：选择文件并填写“导入原因”，点击确认。
4. 系统会逐行校验数据合法性，并触发对应的审批或直接保存逻辑。

### 3.2 批量更新与删除

- **批量更新状态**：在列表页勾选多条数据，可以批量修改其“状态”字段（如冻结、注销等）。
- **批量删除**：勾选数据后点击“批量删除”，同样需要填写删除原因。系统支持“软删除”机制，数据记录在数据库中仍会保留，但标记为已删除。

## 4. 常见问题 (FAQ)

<callout emoji="💡" background-color="light-blue">
为何我点击提交后数据没有立即出现在列表页？
</callout>

这通常是因为该表配置了**审批流**。数据目前存在于“审批草稿”中。只有当审批流程最终通过后，系统才会将数据从草稿表同步到正式业务表。您可以前往“我的申请”中查看审批进度。

<callout emoji="⚠️" background-color="light-yellow">
为何某些下拉框加载不出内容？
</callout>

请联系系统管理员检查“字段管理”中的“数据源/关联配置”。确保关联表已配置正确，且当前用户有权访问该关联表的数据。

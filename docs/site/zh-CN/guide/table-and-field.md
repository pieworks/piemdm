# 表与字段管理

PieMDM 允许管理员根据业务需求自定义数据模型。通过“表与字段管理”，您可以定义主数据实体及其属性。

## 表管理

在 PieMDM 中，“表”代表一个主数据对象（如“供应商”、“物料”、“客户”等）。

### 1. 表属性
创建一个新表时，需要配置以下关键属性：

- **表名 (Code)**：系统的唯一标识，仅限小写字母、数字和下划线（如 `mdm_material`）。系统会自动为物理表名添加 `t_` 前缀。
- **名称 (Name)**：显示的业务名称（如“物料主数据”）。
- **展示模式 (DisplayMode)**：
  - `List`：列表模式，适用于绝大多数扁平化数据。
  - `Tree`：树形模式，适用于具有层级关系的数据（如“组织架构”、“分类字典”）。
- **表类型 (TableType)**：
  - `Entity`：独立的主实体表。
  - `Item`：行项目表，必须关联到一个父表。

### 2. 关联配置（仅 Item 类型）
如果表类型为 `Item`，需要额外配置：
- **父表 (ParentTable)**：该行项目所属的主表。
- **关联字段**：定义子表与父表之间的关联键。

## 字段管理

字段定义了表中存储的具体数据项。PieMDM 提供了丰富的字段类型和验证规则。

### 1. 字段类型预设
字段类型分为以下几个大类：

| 分组 | 包含类型 | 说明 |
| :--- | :--- | :--- |
| **基本类型** | 文本、多行文本、数字、整数、百分比、密码、URL、邮箱、手机号 | 基础数据存储 |
| **选择类型** | 下拉单选、下拉多选、单选框组、复选框组、开关 | 预定义选项数据 |
| **日期时间** | 日期、时间、日期时间 | 时间维度数据 |
| **关系类型** | 多对一 (BelongsTo)、一对多 (HasMany)、多对多 (ManyToMany) | 实现跨表数据关联 |
| **高级类型** | 自动编码、附件、富文本、公式 | 复杂业务场景支持 |

### 2. 字段配置项
- **字段编码**：数据库中的列名。
- **显示名称**：表单和列表中的标签。
- **UI 组件**：定义该字段在界面上的呈现方式（如 `Input`, `Select`, `DatePicker`）。
- **验证规则**：
  - **必填项**：是否允许为空。
  - **长度限制**：最大/最小字符数。
  - **数值范围**：最大/最小值。
  - **正则匹配**：自定义格式校验。

## 系统预留字段

为了支持审计、版本管理和审批工作流，PieMDM 会为每个表自动添加以下预留字段。用户不得创建与这些字段编码相同的自定义字段。

- **审计字段**：`id`, `created_at`, `updated_at`, `deleted_at`, `created_by`, `updated_by`。
- **业务状态**：`status` (数据状态), `draft_status` (草稿状态)。
- **流程追踪**：`approval_code` (审批单号), `entity_id` (原始实体 ID)。

## 操作流程

1. **新建表**：定义表的基本信息和存储引擎配置。
2. **定义字段**：根据业务属性逐一添加字段，配置其类型和校验规则。
3. **生成物理表**：保存配置后，系统会在数据库中自动创建或更新对应的物理表结构。
4. **权限分配**：在“菜单管理”中为新表配置访问入口，并为相应角色分配查看和编辑权限。

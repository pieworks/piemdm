# 审批流程定义与管理

PieMDM 提供了高度可配置的审批引擎。您可以根据业务需求，为不同的实体（表）和操作（如新增、修改、删除）定义个性化的审批流程。

## 1. 审批定义 (Approval Definition)

“审批定义”是流程的模板，它描述了一个完整的审批流如何运行。

### 1.1 基础配置
- **定义名称与编码**：每一个审批流都有唯一的编码（Code）和易于理解的名称。
- **状态管理**：
    - **草稿 (Draft)**：正在编辑中，不可被引用。
    - **激活 (Active)**：正式生效，可以被绑定到实体操作上。
    - **停用 (Inactive)**：暂时下线，已发起的流程将继续执行，但新操作将不再触发该流程。
- **发布与版本控制**：系统支持多版本管理。当您修改了已发布的审批流并选择“重新发布”时，系统会生成新的版本号，确保流程变更的可追溯性。

### 1.2 审批平台
PieMDM 支持多种审批触达方式：
- **自研审批 (Internal)**：直接在 PieMDM 网页端进行处理。
- **飞书审批 (Feishu)**：系统可同步飞书的审批表单与节点，用户直接在飞书对话框中完成审批。

## 2. 审批节点 (Approval Node)

一个审批流由多个节点有序组成。

### 2.1 节点类型
- **开始节点 (Start)**：流程的发起点，通常由提交数据的用户触发。
- **审批节点 (Approval)**：核心人工审核节点。
- **抄送节点 (CC)**：通知相关人员，仅限阅知，不影响流程流转。
- **条件分支 (Condition)**：根据数据内容（如金额、所属部门）自动路由到不同的审批分支。
- **结束节点 (End)**：流程的终点，标志着数据正式生效。

### 2.2 审批人配置
您可以灵活定义每个节点的审批人：
- **指定人员**：通过用户列表选择具体人员。
- **指定角色**：例如“财务总监”，属于该角色的所有用户均可审批。
- **动态关系**：例如“直属主管”、“部门负责人”。

## 3. 绑定实体操作 (Table Binding)

定义好审批流后，需要将其与具体的实体表操作关联起来，才能发挥作用。

您可以在“模型管理 > 审批设置”或“流程管理 > 表绑定”中进行配置：
- **实体表**：选择目标实体（如“供应商信息”）。
- **操作类型**：
    - **新增 (Create)**：新录入数据是否需审批。
    - **修改 (Update)**：编辑已有数据是否需审批。
    - **删除 (Delete)**：作废数据是否需审批。
- **绑定流程**：选择一个处于“激活”状态的审批定义。

## 4. 流程发布机制

<callout emoji="🚀" background-color="light-green">
当您完成节点配置后，必须点击“验证并发布”。系统会检查流程是否闭环（即是否有终点）、是否有孤立节点以及审批人配置是否有效。
</callout>

## 5. 常见问题

<callout emoji="❓" background-color="light-purple">
修改审批定义后，正在运行的任务会变吗？
</callout>

不会。已经发起的审批实例将严格按照**发起时**的流程定义版本运行。只有新发起的申请才会使用最新发布的版本。

<callout emoji="❓" background-color="light-purple">
一个表可以绑定多个审批流吗？
</callout>

针对同一种操作（如“修改”），一个表只能绑定一个**激活**的流程。但您可以针对“新增”和“修改”分别绑定不同的流程。
